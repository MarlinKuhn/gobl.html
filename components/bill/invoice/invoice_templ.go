// Code generated by templ - DO NOT EDIT.

// templ: version: v0.2.590
package invoice

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import "context"
import "io"
import "bytes"

import (
	"fmt"

	"github.com/invopop/gobl"
	"github.com/invopop/gobl.html/components/regimes/co"
	"github.com/invopop/gobl.html/components/regimes/es"
	"github.com/invopop/gobl.html/components/regimes/mx"
	"github.com/invopop/gobl.html/components/t"
	"github.com/invopop/gobl.html/internal"
	"github.com/invopop/gobl/bill"
	"github.com/invopop/gobl/org"
	"github.com/invopop/gobl/tax"
)

// Invoice renders a complete GOBL bill.Invoice object.
func Invoice(env *gobl.Envelope, inv *bill.Invoice) templ.Component {
	return templ.ComponentFunc(func(ctx context.Context, templ_7745c5c3_W io.Writer) (templ_7745c5c3_Err error) {
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templ_7745c5c3_W.(*bytes.Buffer)
		if !templ_7745c5c3_IsBuffer {
			templ_7745c5c3_Buffer = templ.GetBuffer()
			defer templ.ReleaseBuffer(templ_7745c5c3_Buffer)
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("<style type=\"text/css\">\n\t\theader {\n\t\t\twidth: 100%;\n\t\t\tdisplay: flex;\n\t\t\tflex-flow: row wrap;\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t}\n\t\theader div.details {\n\t\t\tflex: 1;\n\t\t\tborder-right: 0.5px solid #E5E7EB;\n\t\t}\n\t\theader div.contacts {\n\t\t\tflex: 1;\n\t\t\t/*display: flex;\n\t\t\tflex-flow: column wrap;*/\n\t\t}\n\t\tsection {\n\t\t\tpadding: 0mm;\n\t\t\t/* width: 100%; */\n\t\t\tflex: 100%;\n\t\t}\n\t\tsection.title {\n\t\t\tpadding-top: 0mm;\n\t\t\tpadding-bottom: 6mm;\n\t\t}\n\t\tsection.title .hero {\n\t\t\tmargin-bottom: 6mm;\n\t\t}\n\t\tsection.title .alias {\n\t\t\tfont-size: 16pt;\n\t\t\tfont-weight: bold;\n\t\t\tcolor: #030712;\n\t\t}\n\t\tsection.title .hero img {\n\t\t\tmax-width: 100%;\n\t\t\t/* max-height: 10mm; */\n\t\t}\n\t\tsection.title h2.code {\n\t\t\tfont-size: 12pt;\n\t\t\tcolor: #030712;\n\t\t\tfont-weight: 600;\n\t\t}\n\t\tsection.summary {\n\t\t\tpadding-right: 6mm;\n\t\t\tpadding-top: 0mm;\n\t\t\tpadding-bottom: 0mm;\n\t\t}\n\t\tsection.summary h2.title {\n\t\t\tdisplay: none;\n\t\t}\n\t\tsection.summary ul {\n\t\t\tlist-style-type: none;\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t\tdisplay: flex;\n\t\t\tflex-flow: row wrap;\n\t\t}\n\t\tsection.summary li {\n\t\t\tmargin-bottom: 6mm;\n\t\t\tflex: 50%;\n\t\t}\n\t\tsection.summary span.label {\n\t\t\tdisplay: block;\n\t\t\tfont-weight: 500;\n\t\t}\n\t\tsection.summary span.value {\n\t\t\tdisplay: block;\n\t\t\tcolor: #030712;\n\t\t}\n\t\tsection.supplier {\n\t\t\tpadding: 6mm;\n\t\t\tpadding-top: 0mm;\n\t\t}\n\t\tsection.customer {\n\t\t\tpadding: 6mm;\n\t\t\tborder-top: 0.5px solid #E5E7EB;\n\t\t}\n\t\tsection.lines {\n\t\t\torder: 5;\n\t\t\tpadding-top: 6mm;\n\t\t\tpadding-bottom: 0mm;\n\t\t}\n\t\tsection.lines h2 {\n\t\t\tdisplay: none;\n\t\t}\n\t\tsection.lines table {\n\t\t\twidth: 100%;\n\t\t}\n\t\tsection.lines th, section.lines td {\n\t\t\ttext-align: left;\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t\tpadding: 1.5mm 2mm;\n\t\t\tmargin: 0px;\n\t\t}\n\t\tsection.lines th {\n\t\t\tfont-weight: 600;\n\t\t\tbackground-color: #F3F4F6;\n\t\t}\n\t\tsection.lines .i,\n\t\tsection.lines .ref {\n\t\t\twidth: fit-content;\n\t\t}\n\t\tsection.lines .price,\n\t\tsection.lines .quantity,\n\t\tsection.lines .tax,\n\t\tsection.lines .discount,\n\t\tsection.lines .charge,\n\t\tsection.lines .total {\n\t\t\ttext-align: right;\n\t\t\twidth: fit-content;\n\t\t\twhite-space: nowrap;\n\t\t}\n\t\tsection.lines .description,\n\t\tsection.lines .reason {\n\t\t\twhite-space: wrap;\n\t\t}\n\t\tsection.lines .label {\n\t\t\tfont-weight: 500;\n\t\t}\n\t\tsection.lines .description .extensions {\n\t\t\tdisplay: block;\n\t\t}\n\t\tsection.lines .description .extensions .label {\n\t\t\tfont-weight: 500;\n\t\t}\n\t\tdiv.totals {\n\t\t\torder: 8;\n\t\t\tdisplay: flex;\n\t\t\tflex-wrap: row;\n\t\t\twidth: 100%;\n\t\t\tpadding-top: 6mm;\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t\tpadding-bottom: 4mm;\n\t\t}\n\t\tdiv.totals td, div.totals th {\n\t\t\tpadding: 1.5mm 2mm;\n\t\t}\n\t\tsection.totals {\n\t\t\torder: 2;\n\t\t\tflex: 1;\n\t\t}\n\t\tsection.totals h2 {\n\t\t\tdisplay: none;\n\t\t}\n\t\tsection.totals table {\n\t\t\tpadding-right: 1cm;\n\t\t\tpadding-left: 1cm;\n\t\t\twidth: auto;\n\t\t\tmargin-right: 0;\n\t\t\tmargin-left: auto;\n\t\t}\n\t\tsection.totals th {\n\t\t\ttext-align: right;\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t\tfont-weight: normal;\n\t\t}\n\t\tsection.totals td {\n\t\t\ttext-align: right;\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t}\n\t\tsection.totals tr:last-child th,\n\t\tsection.totals tr:last-child td {\n\t\t\tborder-bottom: 0;\n\t\t}\n\t\tsection.totals tr.strong th,\n\t\tsection.totals tr.strong td {\n\t\t\tfont-weight: 600;\n\t\t}\n\t\tsection.taxes {\n\t\t\torder: 1;\n\t\t\tflex: 1;\n\t\t}\n\t\tsection.taxes h2 {\n\t\t\tdisplay: none;\n\t\t}\n\t\tsection.taxes table {\n\t\t\tpadding-right: 1cm;\n\t\t\tpadding-left: 1cm;\n\t\t\tmargin-left: 0;\n\t\t\twidth: 90%;\n\t\t}\n\t\tsection.taxes th, section.taxes td {\n\t\t\ttext-align: right;\n\t\t\tpadding: 1.5mm 2mm;\n\t\t}\n\t\tsection.taxes th {\n\t\t\tbackground-color: #F3F4F6;\n\t\t\tfont-weight: 600;\n\t\t}\n\t\tsection.taxes td {\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t}\n\t\tsection.taxes tr:last-child td {\n\t\t\tborder-bottom: 0;\n\t\t}\n\t\tsection.taxes th.category,\n\t\tsection.taxes td.category {\n\t\t\ttext-align: left;\n\t\t}\n\t\tsection.payment {\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t\tpadding: 6mm 0mm;\n\t\t\torder: 10;\n\t\t\tdisplay: flex;\n\t\t\tflex-flow: row;\n\t\t\tbreak-inside: avoid;\n\t\t}\n\t\tsection.payment h2.title {\n\t\t\tdisplay: none;\n\t\t}\n\t\tsection.payment ul {\n\t\t\tlist-style-type: none;\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n\t\tsection.payment ul.instructions {\n\t\t\tmargin-right: 6mm;\n\t\t}\n\t\tsection.payment li {\n\t\t\tmargin-bottom: 3mm;\n\t\t}\n\t\tsection.payment li:last-child {\n\t\t\tmargin-bottom: 0;\n\t\t}\n\t\tsection.payment span.label {\n\t\t\tdisplay: block;\n\t\t\tfont-weight: 500;\n\t\t}\n\t\tsection.payment span.value {\n\t\t\tdisplay: block;\n\t\t}\n\t\tsection.payment table td {\n\t\t\tpadding-right: 3mm;\n\t\t}\n\t\tsection.payment .due-dates span.percent:before {\n\t\t\tcontent: \"(\"\n\t\t}\n\t\tsection.payment .due-dates span.percent:after {\n\t\t\tcontent: \")\"\n\t\t}\n\t\tsection.notes {\n\t\t\tpadding-top: 6mm;\n\t\t\tpadding-bottom: 3mm;\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t\tbreak-inside: avoid;\n\t\t}\n\t\tsection.notes .note {\n\t\t\tmargin-bottom: 3mm;\n\t\t}\n\t\t.extensions section {\n\t\t\tbreak-inside: avoid;\n\t\t\tpadding-top: 6mm;\n\t\t\tpadding-bottom: 6mm;\n\t\t\tborder-bottom: 0.5px solid #E5E7EB;\n\t\t}\n\t\t.extensions:empty {\n\t\t\tdisplay: none;\n\t\t}\n\t\t.org-party .name {\n\t\t\tfont-weight: 600;\n\t\t\tfont-size: 12pt;\n\t\t\tline-height: 20pt;\n\t\t\tcolor: #030712;\n\t\t}\n\t</style><article class=\"invoice\"><header><div class=\"details\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = title(inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = summary(inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</div><div class=\"contacts\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = supplier(inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if inv.Customer != nil {
			templ_7745c5c3_Err = customer(inv).Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</div></header>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = lines(inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("<div class=\"totals\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = totals(inv, inv.Totals).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = taxes(inv, inv.Totals.Taxes).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = payment(inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = notes(inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("<div class=\"extensions\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = es.TicketBAIQR(env).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = co.DIANQR(env, inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = mx.CFDI(env, inv).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</div></article>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if !templ_7745c5c3_IsBuffer {
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteTo(templ_7745c5c3_W)
		}
		return templ_7745c5c3_Err
	})
}

func title(inv *bill.Invoice) templ.Component {
	return templ.ComponentFunc(func(ctx context.Context, templ_7745c5c3_W io.Writer) (templ_7745c5c3_Err error) {
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templ_7745c5c3_W.(*bytes.Buffer)
		if !templ_7745c5c3_IsBuffer {
			templ_7745c5c3_Buffer = templ.GetBuffer()
			defer templ.ReleaseBuffer(templ_7745c5c3_Buffer)
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var2 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var2 == nil {
			templ_7745c5c3_Var2 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("<section class=\"title\"><div class=\"hero\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if img := supplierLogo(ctx, inv); img != nil {
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("<img src=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(img.URL))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("\" alt=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(img.Label))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("\" height=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(logoHeight(img)))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		} else {
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("<div class=\"alias\">")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var3 string
			templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(supplierAlias(inv))
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `components/bill/invoice/invoice.templ`, Line: 320, Col: 25}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</div><h1 class=\"type\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = t.T("billing.invoice.title."+i18nTitleTag(inv)).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</h1><h2 class=\"code\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var4 string
		templ_7745c5c3_Var4, templ_7745c5c3_Err = templ.JoinStringErrs(code(inv.Series, inv.Code))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `components/bill/invoice/invoice.templ`, Line: 328, Col: 31}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var4))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString("</h2></section>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if !templ_7745c5c3_IsBuffer {
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteTo(templ_7745c5c3_W)
		}
		return templ_7745c5c3_Err
	})
}

func i18nTitleTag(inv *bill.Invoice) string {
	typ := string(inv.Type)
	if inv.Tax.ContainsTag(tax.TagSimplified) {
		typ = typ + "-simplified"
	}
	return typ
}

func supplierAlias(inv *bill.Invoice) string {
	if inv.Supplier.Alias != "" {
		return inv.Supplier.Alias
	}
	return inv.Supplier.Name
}

func supplierLogo(ctx context.Context, inv *bill.Invoice) *org.Image {
	opts := internal.Options(ctx)
	if opts.Logo != nil {
		return opts.Logo
	}
	if len(inv.Supplier.Logos) > 0 {
		return inv.Supplier.Logos[0]
	}
	return nil
}

func logoHeight(img *org.Image) string {
	if img.Height != 0 {
		return fmt.Sprint(img.Height)
	}
	return "40" // pixels
}

func code(series, code string) string {
	if series == "" {
		return code
	}
	return fmt.Sprintf("%s-%s", series, code)
}
